{{ define "title" }}Главная{{ end }}
{{ define "body" }}
<h1 class="mb-4">Управление агентами</h1>

<!-- Список групп -->
<div class="card mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
        <span>Группы клиентов</span>
        <a href="/groups" class="btn btn-outline-primary btn-sm">Перейти к управлению группами</a>
    </div>
    <div class="card-body">

        {{ if .Groups }}
            {{ range $group := .Groups }}
                <div class="card mb-3">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">{{ $group.Name }}</h5>
                    </div>
                    <div class="card-body p-0">
                        <table class="table table-hover mb-0">
                            <tbody>
                                {{ range $id := $group.Members }}
                                    <tr>
										<td>{{ $id.Hostname }}</td>
                                        <td>{{ $id.IP }}</td>
										<td>{{ $id.LastActiveTime.Format "2006-01-02 15:04:05" }}</td>
										<td>
											{{ if $id.Online }}
												<span class="badge bg-success">Онлайн</span>
											{{ else }}
												<span class="badge bg-secondary">Оффлайн</span>
											{{ end }}
										</td>
                                        <td>
                                            <form action="/group/send" method="POST" class="d-flex gap-2 align-items-center">
                                                <input type="hidden" name="group_name" value="{{ $group.Name }}">
                                                <input type="text" name="command" class="form-control form-control-sm" placeholder="Команда">
                                                <button type="submit" class="btn btn-primary btn-sm">Отправить</button>
                                            </form>
                                        </td>
                                    </tr>
                                {{ end }}
                            </tbody>
                        </table>
                    </div>
                </div>
            {{ end }}
        {{ else }}
            <p class="text-muted">Нет созданных групп</p>
        {{ end }}
    </div>
</div>

<!-- Одобренные клиенты -->
<div class="card mb-4">
    <div class="card-header">Одобренные клиенты</div>
    <div class="card-body">
        {{ if .ApprovedClients }}
            <table class="table table-striped">
                <thead>
                    <tr>
						<th>Имя хоста</th>
                        <th>ID клиента</th>
                        <th>IP-адрес</th>
                        <th>Последняя активность</th>
						<th>Статус</th>
                        <th>Действие</th>
                    </tr>
                </thead>
                <tbody>
                    {{ range $client := .ApprovedClients }}
                        <tr>
							<td>{{ $client.Hostname }}</td>
                            <td>{{ $client.ID }}</td>
                            <td>{{ $client.IP }}</td>
                            <td>{{ $client.LastActiveTime.Format "2006-01-02 15:04:05" }}</td>
							<td>
                                {{ if $client.Online }}
                                    <span class="badge bg-success">Онлайн</span>
                                {{ else }}
                                    <span class="badge bg-secondary">Оффлайн</span>
                                {{ end }}
                            </td>
                            <td><form action="/send" method="POST">
                                <input type="hidden" name="client_id" value="{{ $client.ID }}">
                                <input type="text" name="command" placeholder="gHN, gCPU...">
                                <button type="submit" class="btn btn-primary btn-sm">Отправить</button>
                            </form></td>
							<td><form action="/client/delete" method="POST">
									<input type="hidden" name="client_id" value="{{ .ID }}">
									<button type="submit" class="btn btn-outline-danger btn-sm" onclick="return confirm('Вы уверены?')">Удалить</button>
							</form></td>
                        </tr>
                    {{ else }}
                        <tr><td colspan="4">Нет одобренных клиентов</td></tr>
                    {{ end }}
                </tbody>
            </table>
        {{ else }}
            <p class="text-muted">Нет одобренных клиентов</p>
        {{ end }}
    </div>
</div>

<!-- Ожидающие клиенты -->
<div class="card mb-4">
    <div class="card-header">Ожидают одобрения</div>
    <div class="card-body">
        {{ if .PendingClients }}
            <table class="table table-hover">
                <thead>
                    <tr>
						<th>Имя хоста</th>
                        <th>ID клиента</th>
                        <th>IP-адрес</th>
                        <th>Время регистрации</th>
						<th>Статус</th>
                        <th>Действие</th>
                    </tr>
                </thead>
                <tbody>
                    {{ range $client := .PendingClients }}
                        <tr>
							<td>{{ $client.Hostname }}</td>
                            <td>{{ $client.ID }}</td>
                            <td>{{ $client.IP }}</td>
                            <td>{{ $client.LastActiveTime.Format "2006-01-02 15:04:05" }}</td>
							<td>
                                {{ if $client.Online }}
                                    <span class="badge bg-success">Онлайн</span>
                                {{ else }}
                                    <span class="badge bg-secondary">Оффлайн</span>
                                {{ end }}
                            </td>
                            <td>
                                <form action="/approve" method="POST">
                                    <input type="hidden" name="client_id" value="{{ $client.ID }}">
                                    <button type="submit" class="btn btn-success btn-sm">Принять</button>
                                </form>
                            </td>
                        </tr>
                    {{ else }}
                        <tr><td colspan="4">Новых клиентов нет</td></tr>
                    {{ end }}
                </tbody>
            </table>
        {{ else }}
            <p class="text-muted">Новых клиентов нет</p>
        {{ end }}
    </div>
</div>

<!-- Форма отправки команды -->
<div class="card mb-4">
    <div class="card-header">Отправить команду</div>
    <div class="card-body">
        <form action="/send" method="POST">
            <div class="mb-3">
                <label for="client" class="form-label">Выберите клиента:</label>
                <select name="client_id" id="client" class="form-select">
                    <option value="all">Все клиенты</option>
                    {{ range $client := .ApprovedClients }}
                        <option value="{{ $client.ID }}">{{ $client.ID }}</option>
                    {{ end }}
                </select>
            </div>
            <div class="mb-3">
                <input type="text" name="command" id="command" class="form-control" placeholder="get HN, list VC, get GPU">
            </div>
            <button type="submit" class="btn btn-primary">Отправить</button>
        </form>
    </div>
</div>

<!-- Логи ответов -->
<div class="card">
    <div class="card-header">Последние ответы</div>
    <div class="card-body">
        {{ if .Responses }}
            {{ range .Responses }}
                <pre><strong>{{ . }}</strong></pre>
            {{ end }}
        {{ else }}
            <p class="text-muted">Нет ответов</p>
        {{ end }}
    </div>
</div>
{{ end }}